load("@rules_python//python:defs.bzl", "py_library")
load("@rules_semiwrap//:defs.bzl", "copy_extension_library")
load("//bazel_scripts:file_resolver_utils.bzl", "local_extension_util")
load("//subprojects/robotpy-wpimath/tests/cpp:generated_build_info.bzl", "wpimath_test_extension")

wpimath_test_extension(
    entry_point = ["wpimath_test/src/module.cpp"],
    extra_hdrs = glob(["wpimath_test/include/*.h"]),
    header_to_dat_deps = glob(["wpimath_test/include/*.h"]),
    includes = ["wpimath_test/include"],
    other_deps = [local_extension_util("//subprojects/robotpy-wpimath", "wpimath")],
)

copy_extension_library(
    name = "copy_wpimath_test",
    extension = "_wpimath_test",
    output_directory = "wpimath_test/",
)

py_library(
    name = "wpimath_test",
    srcs = glob(["wpimath_test/**/*.py"]) + ["wpimath_test/_init__wpimath_test.py"],
    data = [
        ":copy_wpimath_test",
    ],
    imports = ["."],
    visibility = ["//visibility:public"],
)

filegroup(
    name = "generated_files",
    srcs = [
        "wpimath_test.generated_files",
    ],
    tags = ["manual"],
    visibility = ["//visibility:public"],
)
